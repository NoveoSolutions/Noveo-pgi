
{% block content %}

<div class="page-heading" {{ stimulus_controller('modal-form') }}>                              
        <div class="page-title">
            <div class="row">                   
                <div class="col-12 col-md-6 order-md-1 order-last">

                    <p class="text-subtitle text-muted">Liste de vos clients</p>
                </div>
                <div class="col-12 col-md-6 order-md-2 order-first">
                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Gestion</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Clients</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
</div>
<section class="section" {{ stimulus_controller('modal-form',{formUrl: path('app_form_modal_clients')}) }} >
    <div class="card">
        <div class="card-header">
        <div class="dropdown">
                 <button class="btn btn-primary dropdown-toggle me-1" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Options
                </button>
                        <ul class="dropdown" aria-labelledby="dropdownMenuButton"  data-popper-placement="bottom-start">                            
                                    <button class="dropdown" data-action="modal-form#openModal">
                                    Ajouter un client</button>
                                </ul>
                                    {{ include('_modal.html.twig', 
                {modalTitle: 'Ajouter un client',
                }) }}
        </div>                       
        </div>    
            <div class="card-body ">                   
                <table class="table " id="tableclients">
                    <thead>
                        <tr>
                            <th>Nom</th>
                                <th>Prenom</th>
                                <th>Téléphone</th>
                                <th>Commandes</th>
                                <th>Id</th>
                                <th>Consulter</th>
                                <th>Modifier</th>
                                <th>Supprimer</th>
                                </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>             
            </div>                        
    </div>
</section>

    <!-- Modal 1 -->

    <div class="modal fade" id="displayModal" tabindex="-1" aria-labelledby="displayModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="displayModalLabel">Fiche client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            <a class="btn btn-primary" href="http://127.0.0.1:8000/client/154">Consulter</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal 2 -->

    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">Modifier client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal 3 -->

    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">Supprimer la fiche client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <h6>Êtes vous certains de vouloir Supprimer cet élément?</h6>
          </div>
          <div class="modal-footer">
          <input type="hidden" id="iddeinputhidden"/>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            <button id="deleteclient2" type="button" class="btn btn-primary" data-bs-dismiss="modal">Confirmer</button>
          </div>
        </div>
      </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="https://cdn.datatables.net/v/bs5/dt-1.13.1/datatables.min.js"></script>   
<script>


var table = $(function() {
    $('#tableclients').DataTable({  

    processing: true,
    serverSide: true,
    searching: true,
    stateSave: true,
    paging: true,
    ajax: {
    url: "/clients/datatables",
    data: function ( d ) {
    d.start = d.start || 0;
    d.length = d.length || 0;
    d.search = d.search;
    },    
    },
    aLengthMenu: [ [3, 5, 15], ['3', '5', '15'] ],
    columns: [
    { data: "nom" },
    { data: "prenom" },
    { data: "telephone" },
    { data: "commandes" },
    { data: "id" },
    { data: "consulter" },
    /*{ data: null, title: 'Consulter', width: '5%',
     "render": function (data, type, row, meta) {
        return '<button id="displayclient" type="button" data-bs-toggle="modal" data-bs-target="#displayModal" class="btn btn-primary"><i class="bi bi-search"></</button>' 
        } }, */
    { data: null, title: 'Modifier', width: '5%',
    "render": function (data, type, row, meta) {
    return '<button type="button" data-bs-toggle="modal" data-bs-target="#editModal" class="btn btn-success"><i class="bi bi-pen"></button>' 
    } },
   /* { data: null, title: 'Supprimer', width: '5%',
     "render": function (data, type, row, meta) {
        return '<button  type="button" data-bs-toggle="modal" data-bs-target="#deleteModal" class="btn btn-danger" data-id=><i class="bi bi-trash"></</button>' 
        } }  */  
     { data: "supprimer" }   
    ]
    });

  /*  $('.open-modal_deleteclient').on( 'click', function () {
 $('#deleteclient').attr('data-id', $(this).data('id'));
    });*/
$(document).on("click", ".open-modal_deleteclient", function () { 

let test = {"nom":"Macaron"}

    $.ajax ({
            type:"PUT",
            url:'api/clients/222',
            contentType: "application/json",
            data: JSON.stringify(test),
            success: function(){
              var msg = "update succesful";
              console.log(msg);
            },               
            });   


  $('#iddeinputhidden').val($(this).data('id'));
 // $('#deleteclient2').attr('data-id', $(this).data('id'));
// $('#deleteclient2').load();
 //  console.log('ok');
          
    });



$(document).on("click", "#deleteclient2", function () {
 // console.log( $(this).data('id'));
    
   $.ajax ({
                url:'api/clients/'+$('#iddeinputhidden').val(),
                method: "DELETE"
            });   

           $('#tableclients').DataTable().ajax.reload();   
                
    });

 /*  $('#deleteclient').on( 'click', function () {

    alert($(this).data('id'));
            $.ajax ({
                url:'api/clients/'+$(this).data('id'),
                method: "DELETE"
            });   

            $('#tableclients').DataTable().ajax.reload();        
    });
   */
    $('#updateclient').on( 'click', function () {


           /* $.ajax ({
              data: {
              "telephone": 5
            }
                url:'api/clients/222',
                method: "PATCH"
            });  */ 

            $('#tableclients').DataTable().ajax.reload();        
    });

});

</script>
{% endblock %}

