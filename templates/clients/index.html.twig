{% extends 'base.html.twig' %}
{% block title %}{{ title }}{% endblock %}
{% block content %}

<div class="page-heading">                              
        <div class="page-title">
            <div class="row">                   
                <div class="col-12 col-md-6 order-md-1 order-last">
                    <h3>{{ title }}</h3>
                    <p class="text-subtitle text-muted">Liste de vos clients</p>
                </div>
                <div class="col-12 col-md-6 order-md-2 order-first">
                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Gestion</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Clients</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
</div>
<section class="section" {{ stimulus_controller('modal-form') }}>
    <div class="card">
        <div class="card-header">
                <button class="btn btn-primary dropdown-toggle me-1" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                Options
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton"  data-popper-placement="bottom-start">                            
                            <button class="dropdown-item" data-action="modal-form#openModal">
                            Ajouter un client</button>
                        </div>
                        {{ include('_modal.html.twig', 
        {modalTitle: 'Ajouter un client',
        }) }}
        </div>    
            <div class="card-body ">                   
                <table class="table " id="tableclients">
                    <thead>
                        <tr>
                            <th>Nom</th>
                                <th>Prenom</th>
                                <th>Téléphone</th>
                                <th>Commandes</th>
                                <th>Id</th>
                                <th>Consulter</th>
                                <th>Modifier</th>
                                <th>Supprimer</th>
                                </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>             
            </div>                        
    </div>
</section>

    <!-- Modal 1 -->

    <div class="modal fade" id="displayModal" tabindex="-1" aria-labelledby="displayModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="displayModalLabel">Fiche client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            <a class="btn btn-primary" href="http://127.0.0.1:8000/client/22">Consulter</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal 2 -->

    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editModalLabel">Modifier client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
          {{form (form)}}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal 3 -->

    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">Supprimer la fiche client</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <h6>Êtes vous certains de vouloir Supprimer cet élément?</h6>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            <button id="deleteclient" type="button" class="btn btn-primary" data-bs-dismiss="modal">Confirmer</button>
          </div>
        </div>
      </div>
    </div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="https://cdn.datatables.net/v/bs5/dt-1.13.1/datatables.min.js"></script>   
<script src="assets/js/bootstrap.js"></script>
<script>


var table = $(function() {
    $('#tableclients').DataTable({  

    processing: true,
    serverSide: true,
    searching: true,
    stateSave: true,
    paging: true,
    ajax: {
    url: "/clients/datatables",
    data: function ( d ) {
    d.start = d.start || 0;
    d.length = d.length || 0;
    d.search = d.search;
    },    
    },
    aLengthMenu: [ [3, 5, 15], ['3', '5', '15'] ],
    columns: [
    { data: "nom" },
    { data: "prenom" },
    { data: "telephone" },
    { data: "commandes" },
    { data: "id" },
    { data: null, title: 'Consulter', width: '5%',
     "render": function (data, type, row, meta) {
        return ' <button id="displayclient" type="button" data-bs-toggle="modal" data-bs-target="#displayModal" class="btn btn-primary"><i class="bi bi-search"></</button>' 
        } }, 
    { data: null, title: 'Modifier', width: '5%',
    "render": function (data, type, row, meta) {
    return ' <button type="button" data-bs-toggle="modal" data-bs-target="#editModal" class="btn btn-success"><i class="bi bi-pen"></</button>' 
    } },
    { data: null, title: 'Supprimer', width: '5%',
     "render": function (data, type, row, meta) {
        return '<button  type="button" data-bs-toggle="modal" data-bs-target="#deleteModal" class="btn btn-danger"><i class="bi bi-trash"></</button>' 
        } }       
    ]
    });
   
   console.log(table);

   $('#displayclient').on( 'click', function () {

            $.ajax ({
                url:'api/clients/{id}',
                method: "GET"
            });  
                  
    });

   
    $('#updateclient').on( 'click', function () {


            $.ajax ({
                url:'api/clients/{id}',
                method: "PATCH"
            });   

            $('#tableclients').DataTable().ajax.reload();        
    });

     $('#deleteclient').on( 'click', function () {


            $.ajax ({
                url:'api/clients/{id}',
                method: "DELETE"
            });   

            $('#tableclients').DataTable().ajax.reload();        
    });

});

</script>
{% endblock %}

